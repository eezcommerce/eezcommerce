<div class="container">
	<div class="row m-0">
		<div class="pb-2 mt-4 mb-2 col-md-4">
			<!--header-->
			<h1><strong>Orders</strong></h1>
		</div>
	</div>
	<div class="row">

		<div class="col-md-4">
			 
		

		</div>
	</div>

	<div class="container-fluid">

		<div class="row">
			<div class="col-md-12">
				<div class="table" id="order-data" data-toggle="table">
					<table class="table table-striped table-hover" id="orderTable">

					<button class="btn badge-pill btn-outline-primary btn-sm addOrder" 
					data-toggle="modal" data-target="#addOrderModal">
						<i class="fas fa-plus"></i> Add Order
					</button>

					<div class="table responsive">
							<thead>
								<tr>
								<th data-field="Oid" data-sortable="true">Order ID</th>
								<th data-field="Des" data-sortable="true">Destination</th>
								<th data-field="Sta" data-sortable="true">Status</th>
								<th data-field="TTL" data-sortable="true">Total</th>
							<th></th>
							</tr>
							</thead>
							<tbody>
							{{#each orders}}

								<tr class="OrderRow" data-toggle="modal" data-id='{{_id}}' data-target="#orderDetail" aria-hidden="true">
									<th scope="row">{{_id}}</th>
									<td>{{destAddress}}</td>
									<td>{{status}}</td>
									<td>${{total}}</td>
								</tr>
							{{/each}}
							</tbody>
						</div>
					</table>
				</div>
				</table>
			</div>
			</table>
		</div>
		<!--table-->
	</div>
	<!--row-->
</div>


<script>
	$(document).ready(function(){

 		 $('#orderTable').DataTable();
	});
	
	$(".addOrder").click((e)=>{
		$.get("/AddOrderModal/", (prod)=> {
			$('#addOrderModal').find('#ProdList').html("<tr><th>Masks</th><th>15.45</th><th>Qty</th><th><button id='addProd' class='btn badge-pill btn-outline-primary btn-sm float-right'>Add</button></th></tr>");	
			

			$('#addOrderModal').find('#ProdList').append("<tr><th>"
			+	prod.name[1] + "</th><th>" + prod.price[1]  
			+	"</th><th> Qty</th><th><button id='addProd' class='btn badge-pill btn-outline-primary btn-sm float-right'>Add</button></th></tr>");	
		})
	})

	$(".OrderRow").click((e)=>{
		
	var id = $(e.currentTarget).data("id");
	
	$.get("/getOrderDetail/"+ id, (data)=>{
		$('#orderDetail').find('#title').html("Order #" + data.order._id);
		$('#orderDetail').find('#DesAddress').html("<strong>" + data.order.destAddress + "</strong>");
		$('#orderDetail').find('#oCC').html("<strong>Credit Card</strong> **** **** **** " + data.order.CC);
		$('#orderDetail').find('#oTotal').html("<strong>Total:</strong> $ " + data.order.total).toFixed(2);
		$('#orderDetail').find('#ProductsList').html("");
		var j = 0;
		for (i in data.order.ProductList){
			$.get("/getProductDetail/"+ data.order.ProductList[i].ProductID, (info) =>{
			$('#orderDetail').find('#ProductsList').append("<tr><td>" 
				+ info.product.SKU + "</td><td>" 
				+ info.product.name + "</td><td>"
				+ data.order.ProductList[j++].Qty +"</td><td>"
				+ info.product.price.toFixed(2) + "</td></tr>");
		})
		}
	})
})

</script>