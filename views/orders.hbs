<div class="container">
	<div class="row">
		<div class="pb-2 mt-4 mb-2 col-md-4">
			<!--header-->
			<h1><strong>Orders</strong></h1>
		</div>
		<div class="offset-10 col-md-2">
			<button class="btn badge-pill btn-outline-primary btn-sm" data-toggle="modal" data-target="#addOrderModal">
				Add Order
			</button>

		</div>
		<div class="col-md-12">
			<div class="table" id="order-data">
				<table class="table table-striped table-hover" id="orderTable">
					<div class="table responsive">
						<thead>
							<tr>
								<th>Order ID</th>
								<th>Destination</th>
								<th>Status</th>
								<th>Total</th>
								<th>Ordered</th>
							</tr>
						</thead>
						<tbody>
							{{#each orders}}
								<tr class="OrderRow" data-toggle="modal" data-id='{{_id}}' data-target="#orderDetail" aria-hidden="true">

									<th scope="row">{{truncate _id 7}}</th>
									<td>{{destAddress}}</td>
									<td>{{status}}</td>
									<td>{{toFixed total 2}}</td>
									<td>{{moment this.created_at "YYYY-MM-DD"}}</td>
								</tr>
							{{/each}}
						</tbody>
					</div>
				</table>
			</div>
			<!--table-->

		</div>
	</div>
	<!--row-->
</div>

<script>

	$(document).ready(function(){
		  $('#orderTable').DataTable();
	});
	

	$(".OrderRow").click((e)=>{

	id = $(e.currentTarget).data("id");
		
	$.get("/getOrderDetail/"+ id, (data)=>{
		$('#orderDetail').find('#title').html("Order #" + data.order._id);
		$('#orderDetail').find('#DesAddress').html("<strong>" + data.order.destAddress + "</strong>");
		$('#orderDetail').find('#oCC').html("<strong>Credit Card</strong> **** **** **** " + data.order.CC);
		$('#orderDetail').find('#oStatus').html("<strong>Status: </strong>" + data.order.status);
		$('#orderDetail').find('#oTotal').html("<strong>Total:</strong> $ " + data.order.total);

		$('#odStatus').val(data.order.status);

		$('#orderDetail').find('#ProductsList').html("");
		var j = 0;
		for (i in data.order.ProductList){
			
			$.get("/getProductDetail/"+ data.order.ProductList[i].ProductID, (info) =>{
			$('#orderDetail').find('#ProductsList').append("<tr><td>" 
				+ info.product.SKU + "</td><td>" 
				+ info.product.name + "</td><td>"
				+ data.order.ProductList[j++].Qty +"</td><td>"
				+ info.product.price.toFixed(2) + "</td></tr>");
		})
		}
	})
})
</script>
