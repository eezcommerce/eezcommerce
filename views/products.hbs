<div class="container">
	<div class="row m-0">
		<div class="pb-2 mt-4 mb-2 col-md-4">
			<!--header-->
			<h1><strong>Products</strong></h1>
		</div>
	</div>
	<div class="row">
		<div class="offset-8 col-md-4">
			<button class="btn badge-pill btn-outline-primary btn-sm" data-toggle="modal"
				data-target="#addProductModal">
				Add Product
			</button>
			<button class="btn badge-pill btn-outline-primary btn-sm" data-toggle="modal" data-target="#addSaleModal">
				Sales
			</button>
		</div>
	</div>

		<div class="container-fluid">

			<div class="row">
				<div class="col-md-12">
					<div class="table" id="order-data">
						<table class="table table-striped table-hover">
							<div class="table responsive">
								<thead>
									<tr>
										<th>SKU</th>
										<th>Product Name</th>
										<th>Inventory</th>
										<th>Price</th>
										<th># of Purchases</th>
										<th></th>
									</tr>
								</thead>
								<tbody>
									{{#each products}}
									<tr class="productRow" data-toggle="modal" data-id='{{_id}}' data-target="#productDetail" aria-hidden="true">
										<th scope="row">{{SKU}}</th>
										<td>{{name}}</td>
										<td>{{quantity}}</td>
										<td>{{price}}</td>
										<td>{{purchased}}</td>
										<td> <button 
										type="button"  
										id="deleteButton" 
										class="btn btn-danger" 
										data-toggle="modal" 
										onclick="deleteRow('{{_id}}')">
										<i class="fas fa-trash"></i>
										</button>
											</td>
										
									</tr>
									{{/each}}

								</tbody>
							</div>
						</table>
					</div>
				</table>
			</div>
			</table>
		</div>
		<!--table-->
	</div>
	<!--row-->
</div>

<script>
	function deleteRow(rowId){
		var deleteIt = confirm("Are you sure you want to delete this product?");
		if(deleteIt){
	$.get("/deleteProduct/" + rowId, (data)=>{
		location.reload();
		console.log(data.product.name + "deleted.");
		});
		}else{
		}	
		$(this).on("hide.bs.modal", function() {
		$('.productRow').attr('data-target','#productDetail');
		});	

		

	//$('#cancelOrderModal').modal('show');
	}
$(".productRow").click((e)=>{

	id = $(e.currentTarget).data("id");

	$.get("/getProductDetail/"+ id, (data)=>{
		console.log(data);

		$('#productDetail').find('#title').html(data.product.name);
		$('#productDetail').find('#skuDetail').html(data.product.SKU);
		$('#productDetail').find('#descDetail').html(data.product.description);
		$('#productDetail').find('#qtyDetail').val(data.product.quantity);
		$('#productDetail').find('#priceDetail').val(data.product.price);
		$('#productDetail').find('#soldDetail').val(data.product.purchased);
	})
})


</script>
